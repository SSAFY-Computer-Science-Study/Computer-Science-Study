# 09. 운영체제 시작하기
## 09-1. 운영체제를 알아야 하는 이유

> `운영체제`   `문제해결`
> 
- 데스크톱 운영체제 - 윈도우, macOS, 리눅스
- 스마트폰 운영체제 - 안드로이드, iOS

### 운영체제란?

- **자원**
    - 프로그램 실행에 필요한 요소 → **시스템 자원**
    - CPU, 메모리, 보조기억장치, 입출력장치 등과 같은 컴퓨터 부품
- **운영체제** *OS; operating system*
    - 실행할 프로그램에 **자원을 할당**하고, 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램
    - 운영체제도 프로그램이므로 메모리에 적재되어야 함
    - 운영체제는 컴퓨터가 부팅될 때 메모리 내 **커널 영역** *kernal space* 이라는 공간에 따로 적재되어 실행
    - **사용자 영역** *user space*
        - 커널 영역을 제외한 나머지 영역, 사용자가 이용하는 **응용 프로그램**이 적재
        - **응용 프로그램 *application software***
            - 사용자가 특정 목적을 위해 사용하는 일반적인 프로그램
            - 워드프로세서, 인터넷브라우저, 메모장, 게임 등
    
    ![Image](https://github.com/user-attachments/assets/d8348fa7-b093-4a25-aaa5-08be19208f49)
    

> **운영체제**는 `커널 영역`에 적재되어 사용자 영역에 적재된 **프로그램**들에 `자원`을 할당하고 `실행`을 돕는 것
> 
- 운영체제가 하는 작업
    - 실행할 프로그램을 메모리 주소가 겹치지 않도록 **`메모리`에 적재**하고, 더 이상 실행되지 않는 프로그램을 메모리에서 삭제하며 지속적으로 **`메모리` 자원을 관리**
    - 어떤 프로그램부터 **`CPU`**를 사용하게 할지 결정, 얼마나 오랫동안 `CPU`를 이용하게 할지 결정
    - 응용 프로그램과 `하드웨어` 사이에서 응용 프로그램에 필요한 **`자원`**을 할당하고, 응용 프로그램이 올바르게 실행되도록 관리
        - 동시에 여러 프로그램이 동일한 입출력장치에 접근 시도 시 동시 접근 방지

- 응용 프로그램에 자원을 효율적으로 배분하고, 실행할 프로그램이 지켜야 할 규칙을 만들어 컴퓨터 시스템 전체를 관리
- **관리할 자원별로 기능이 나누어져 있음**
    
    ![Image](https://github.com/user-attachments/assets/402d74e8-3fbd-41f5-82f6-0f3303dc2d37)
    

### 운영체제를 알아야 하는 이유

- 운영체제가 있기에 하드웨어를 조작하고 관리하는 기능을 직접 작성할 필요 없이
운영체제의 도움을 받아 프로그램을 간편하게 개발할 수 있다
    - 없다면?
        - 1 + 2 결과를 모니터에 출력 → (프로그램 메모리에 적재 코드, CPU가 1 + 2 수행하도록 하는 코드, 모니터에 출력하는 코드 전부 작성)
- 운영체제와의 상호작용으로 하드웨어와 프로그램을 더 깊이 이해하고 문제해결의 실마리를 찾을 수 있다
    - 운영체제는 프로그램이 하드웨어 상에서 어떻게 작동하는지를 알고 있음
    - 예) 오류 메시지

<br>

## 09-2. 운영체제의 큰 그림

> `커널`   `이중 모드`   `시스템 호출`   `운영체제 서비스`
> 

### 운영체제의 심장, 커널

- 운영체제는 현존하는 프로그램 중 **규모가 가장 큰 프로그램** 중 하나
- 다양한 운영체제가 응용 프로그램에 제공하는 서비스 종류도 다양함
- 운영체제의 공통적인 **핵심 서비스**
    - **운영체제의 핵심 서비스를 담당**하는 부분을 **커널** *kernal*
        
        ![image](https://github.com/user-attachments/assets/d9d77893-8f94-47ea-8a76-520d50416cdb)    
- 운영체제가 설치된 모든 기기에는 커널이 있음
    - 어떤 커널을 사용하는지에 따라 여러분이 실행하고 개발하는 프로그램이 하드웨어를 이용하는 양상이 달라지고, 결과적으로 **컴퓨터 전체의 성능도 달라질 수 있음**
- 운영체제의 핵심부 =  커널 → 앞으로 언급되는 `운영체제`는 대체로 `커널`을 지칭
- **커널에 포함되지 않는 운영체제의 서비스**
    - **사용자 인터페이스 *UI;*** *user interface*
        - 윈도우와 바탕화면과 같이 사용자가 **컴퓨터와 상호작용할 수 있는 통로**
        - 커널에 속하지 않은 기능! → 같은 커널이라도 UI는 다를 수 있음
        - **그래픽 유저 인터페이스** *GUI; Graphical User Interface*
            - 그래픽을 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스            
        - **커맨드 라인 인터페이스** *CLI; Command Line Interface*
            - 명령어를 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
            

### 이중 모드와 시스템 호출

> 운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호
→ 운영체제는 **응용 프로그램**이 `시스템 자원`에 **접근**하려고 할 때 오직 **자신을 통해서만 접근**하도록 하여 자원을 보호함
> 
- 운영체제 = 문지기

![image](https://github.com/user-attachments/assets/39f6f689-3676-4fd3-9796-33490135c1ed)


- 응용 프로그램이 자원에 접근하기 위해서는 운영체제에 도움을 요청해야 함
- 응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근하여 요청한 작업을 수행
    - 운영체제가 코드를 실행해서 작업을 수행

문지기 역할을 위해 **`이중 모드`**와 **`시스템 호출`**이 사용

- **이중 모드** *dual mode*
    - **CPU가 명령어를 실행하는 모드**를 크게 `사용자 모드`와 `커널 모드`로 구분하는 방식
    - **사용자 모드** *user mode*
        - 운영체제 서비스를 제공받을 수 없는 실행 모드
        - 커널 영역의 코드를 실행할 수 없는 모드
        - 일반적인 응용 프로그램의 기본 실행 모드
        - 입출력 명령어를 포함하여 하드웨어 자원에 접근하는 명령어 실행 불가
    - **커널 모드** *kernal mode*
        - 운영체제 서비스를 제공받을 수 있는 모드
        - 커널 영역의 코드를 실행할 수 있는 모드
        - `시스템 자원`에 접근 가능
    
    ![image](https://github.com/user-attachments/assets/8d14b571-b6f8-4994-a464-19fe2d56746c)
    
- **시스템 호출** *system call*
    
    ![image](https://github.com/user-attachments/assets/247e3d94-b378-4761-b004-e6b45766292c)

    
    - 사용자 모드로 실행 중인 프로그램이 운영체제 서비스를 받기 위해 운영체제에 보내는 `요청`
    - 사용자 모드로 실행되는 프로그램은 `시스템 호출`을 통해 `커널 모드`로 전환하여 운영체제 서비스를 제공받음
    - 일종의 **소프트웨어 인터럽트**
        - 인터럽트를 발생시키는 특정 `명령어`에 의해 **발생**
- CPU가 **`시스템 호출`을 처리하는 순서**
    - 하드웨어 인터럽트 처리 순서와 유사
    - 시스템 호출을 발생시키는 명령어 실행 시 **CPU**는 지금까지의 작업을 `백업`하고, `커널` 영역 내에 `시스템 호출`을 수행하는 코드(`인터럽트 서비스 루틴`)를 실행한 뒤 다시 기존에 실행하던 응용 프로그램으로 `복귀`하여 실행을 이어나감
- **시스템 호출의 작동 예)**
    - 한 응용 프로그램이 하드 디스크에 데이터를 저장하려 함
        - 사용자 모드로 실행되는 동안에는 자원에 접근할 수 없기에 커널 모드로 전환해야 함
        1. 하드 디스크에 데이터를 저장하는 시스템 호출을 발생시켜 커널 모드로 전환
        2. 운영체제 내의 `하드디스크에 데이터를 저장하는 코드`를 실행함으로써 하드디스크에 접근
        3. 하드 디스크에 접근이 끝났다면 다시 사용자 모드로 복귀하여 실행을 계속함
    
    ![image](https://github.com/user-attachments/assets/83650271-85e0-4585-8ff2-241a88f06b78)

    

> 일반적으로 **응용 프로그램**은 실행 과정에서 **운영체제 서비스를 빈번하게 이용**하며 
빈번하게 **시스템 호출**을 **발생**시키고 **사용자 모드와 커널 모드를 오가며 실행**된다.
> 
> 
> ![image](https://github.com/user-attachments/assets/e603664a-d72c-49fa-bb7b-730d31d1471d)
> 

### 운영체제의 핵심 서비스

1. **프로세스 관리**
    - **프로세스** *process*
        - 실행 중인 프로그램
        - 작업 관리자 > 프로세스
    - 일반적으로 CPU(코어)는 한 번에 하나의 프로세스만 실행할 수 있어 CPU는 이 `프로세스`들을 조금씩 **번갈아 가며 실행**
        - CPU는 한 프로세스를 실행하다가 다른 프로세스로 실행을 **전환**하는 것을 반복
        - 각 프로세스는 `상태`, 사용하고자 하는 `자원`이 **다양**함
        - 당장 실행가능할 수도 불가능할 수도 있음
    - 다양한 `프로세스`를 일목요연하게 **관리**하고 **실행**할 수 있어야 함 → `10장`
    - 여러 프로세스가 동시에 실행되는 환경 → `프로세스 동기화`
    - 프로세스가 더 이상 실행되지 못하는 상황 = `교착 상태`를 해결해야 함
2. **자원 접근 및 할당**
    
    모든 프로세스는 실행을 위해 자원을 필요 → 운영체제는 프로세스들이 사용할 자원에 접근하고 조작함으로써 프로세스에 자원 할당
    
    - **CPU**
        - 메모리에는 여러 프로세스가 적재, CPU는 한 번에 하나의 프로세스만 실행
        - 프로세스들에 공정하게 CPU를 할당하기 위한 **CPU 스케줄링**
            - 어떤 프로세스부터 CPU를 이용하게 할 것이며 얼마나 오래 이용하게 할 것인지 결정
    - **메모리**
        - 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지 결정
            - 프로세스 마다 크기, 주소가 다르고 같은 프로세스도 실행할 때마다 주소 달라질 수 있음
        - 메모리 공간이 꽉 차 있거나 프로세스를 적재하지 못하는 상황 발생 시 처리
    - **입출력장치**
        - `인터럽트 서비스 루틴`은 운영체제가 제공하는 기능으로 `커널` 영역에 존재
        - 입출력장치가 발생시키는 하드웨어 인터럽트도 마찬가지
        - 운영체제는 `인터럽트를 처리하는 프로그램` = `인터럽트 서비스 루틴`을 제공함으로써 **입출력 작업을 수행**
3. **파일 시스템 관리**
    - **파일 시스템** *file system*
        - 보조기억장치 속 데이터를 파일과 디렉터리로 관리


> ### ♻️ 가상 머신과 이중 모드의 발전 - 하이퍼바이저 모드
> 이중 모드 - 커널 모드, 사용자 모드
> 
> **가상 머신을 통한 가상화**를 지원하는 현대 `CPU`는 **두 가지 모드 이상을 지원**
> - **가상 머신 *virtual machine***
>     - 소프트웨어적으로 만들어낸 가상 컴퓨터
>     - 가상 머신을 설치하면 새로운 운영체제와 응용 프로그램을 설치, 실행 가능
> - 컴퓨터에 설치된 운영체제에서 가상 머신을 설치 및 실행한다면, 그 **가상 머신 또한 응용 프로그램**
>     - 사용자 모드로 작동
> - 마찬가지로 **가상 머신상에 설치된 운영체제**(리눅스) 또한 **사용자 모드**로 작동
> - 가상 머신에 설치된 응용 프로그램(웹브라우저)이 운영체제 서비스를 제공받기 위해서는 `커널 모드`로 전환되어야 하는데, 가상머신에 설치된 운영체제도 사용자 모드로 작동하면 운영체제 서비스를 제공받기 어려움
>     
>     ![image](https://github.com/user-attachments/assets/3226c866-6a4b-428c-b9de-88c5db27c2cc)
>     
> - **가상화 지원 CPU**는 커널 모드와 사용자 모드 이외에 가상 머신을 위한 모드인 **하이퍼바이저 모드**를 따로 둠
>     - 가상 머신 상에서 작동하는 응용 프로그램들은 `하이퍼바이저 모드`로써 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받음



> ### ♻️ 시스템 호출의 종류
> 시스템 호출은 운영체제 서비스를 제공받기 위한 방법
> 유닉스, 리눅스 등의 운영체제(POSIX 운영체제)에서 사용되는 대표적인 시스템 호출
> ![image](https://github.com/user-attachments/assets/e8394077-72ce-4e6b-80d2-84526fc80a84)
> 개발자가 작성하는 프로그래밍 언어들은 내부적으로 위와 같은 시스템 호출을 통해 실행     **예) cout, printf**
