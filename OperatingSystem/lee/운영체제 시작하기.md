# Chapter 09. 운영체제 시작하기


## 09-1. 운영체제를 알아야 하는 이유

### 운영체제란

---

모든 프로그램은 하드웨어를 필요로 한다. 계산하는 프로그램은 CPU를, 이미지를 하드 디스크에 저장하는 프로그램은 하드 디스크를 필요로 한다.

- 시스템 자원
    - 프로그램 실행에 마땅히 필요한 요소들
    - CPU, 메모리, 보조기억장치, 입출력장치 등
    - 즉, 모든 프로그램은 실행되기 위해 반드시 자원이 필요함
- 운영체제
    - 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 특별한 `프로그램`
    - 메모리에 적재되어야 함
    - 항상 컴퓨터가 `부팅`될 때 메모리 내 `커널 영역`이라는 공간에 따로 적재되어 실행됨
    - 커널 영역을 제외한 나머지 영역에 사용자가 이용하는 응용 프로그램이 적재되는 공간을 `사용자 영역`이라고 함

> 💡 운영체제는 커널 영역에 적재되어 사용자 영역에 적재된 프로그램들에 자원을 할당하고 이들이 올바르게 실행되도록 돕는다.
>
> ![image.png](https://github.com/user-attachments/assets/6778dc42-a5a2-4830-8416-a57672ad6a5f)
>
> 운영체제는 실행할 프로그램을 메모리에 적재하고 , 더 이상 실행되지 않는 프로그램을 메모리에서 삭제하며 지속적으로 메모리 자원을 관리한다.
>
> ![image.png](https://github.com/user-attachments/assets/0520c562-5bbd-4f7c-8668-5b3816a50758)
>
> 어느 한 프로그램이 CPU 를 독점하면 다른 프로그램들은 올바르게 실행될 수 없기 때문에 운영체제는 최대한 공정하게 여러 프로그램에 CPU 자원을 할당한다. 
>
> ![image.png](https://github.com/user-attachments/assets/f23491fc-516f-407e-90e2-71611e88f9cc)
>
> 이처럼 운영체제는 응용 프로그램과 하드웨어 사이에서 응용 프로그램에 필요한 자원을 할당하고, 응용 프로그램이 올바르게 실행되도록 관리하는 역할을 맡는다.
>
> ![image.png](https://github.com/user-attachments/assets/770ecef0-f52a-40a9-861d-23590f3f9b33)
>
> ![image.png](https://github.com/user-attachments/assets/a2637016-5ec7-4ede-a40c-4fab62cc54e7)

### 운영체제를 알아야 하는 이유

---

운영체제는 프로그램이기 때문에 현재 하드웨어의 상태는 어떠한지, 코드가 어떻게 실행되었는지, 하드웨어 상에 어떤 문제가 있었는지 등을 상세히 알려줄 수 있다.

>💡 대다수의 오류 메시지의 근원은 운영체제다. 작성한 소스 코드를 하드웨어가 제대로 실행하지 못하면 운영체제는 여러분에게 아래와 같은 오류 메시지를 띄운다.
>
> ![image.png](https://github.com/user-attachments/assets/1c69643a-8ebe-4d94-975d-3cf7547b317d)

## 09-2. 운영체제의 큰 그림

> 💡 운영체제는 사용자를 위한 프로그램이 아닌 `사용자가 실행하는 프로그램을 위한 프로그램`이다. 즉, 사용자가 실행하는 응용 프로그램이 올바르게 실행되도록 돕고 필요한 자원을 할당해 주는 프로그램이다.
>
> ![image.png](https://github.com/user-attachments/assets/5961edf0-1461-402b-9794-96c70658eb1c)

### 운영체제의 심장, 커널

---

- 커널
    - 운영체제의 핵심 서비스를 담당하는 부분
    - 운영체제가 설치된 모든 기기에는 커널이 있음
    - 어떤 커널을 사용하는지에 따라 여러분이 실행하고 개발하는 프로그램이 하드웨어를
    이용하는 양상이 달라지고, 결과적으로 컴퓨터 전체의 성능도 달라질 수 있음
- 사용자 인터페이스 (UI)
    - 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스
    - 사용자와 컴퓨터와 상호작용할 수 있는 통로
    - `그래픽 유저 인터페이스 (GUI)`
    - `커맨드 라인 인터페이스 (CLI)`

### 이중 모드와 시스템 호출

---

> 💡 운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호한다.

그래서 운영체제는 응용 프로그램들이 자원에 접근하려고 할 때 오직 자신을 통해서만 접근하도록
하여 자원을 보호한다.

응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근하여 요청한 작업
을 수행한다.

![image.png](https://github.com/user-attachments/assets/349d520a-0778-49d4-8f69-302bbbda3240)

![image.png](https://github.com/user-attachments/assets/74a5ea3c-b50e-4eec-a0fe-4f87eb3af1a6)

### 이중 모드

---

운영체제의 문지기 역할은 `이중모드`로써 구현된다.

- 이중 모드
    - CPU가 명령어를 실행하는 모드를 크게 `사용자 모드`와 `커널 모드`로 구분하는 방식
- 사용자 모드
    - 운영체제 서비스를 제공받을 수 없는 실행 모드
    - 커널 영역의 코드를 실행할 수 없는 모드
    - 일반적인 응용 프로그램
- 커널 모드
    - 운영체제 서비스를 제공받을 수 있는 실행 모드
    - 커널 영역의 코드를 실행할 수 있는 모드
    - 자원에 접근하는 명령어를 비롯한 모든 명령어 실행 가능
    
    ![image.png](https://github.com/user-attachments/assets/b0efc6af-b394-4962-9f0f-096e20489a24)
    

### 시스템 호출

---

> 💡 사용자 모드로 실행되는 프로그램이 `자원에 접근하는 운영체제 서비스를 제공`받으려면?
>
> - `커널 모드`로 전환되어야 함
> - 이때 운영체제 서비스를 제공받기 위한 요청을 `시스템 호출(시스템 콜)`이라고 함

![image.png](https://github.com/user-attachments/assets/2d3db739-46ff-4fc6-b940-6a3cac4a3f3a)

시스템 호출은 일종의 `인터럽트(소프트웨어적인 인터럽트)`다.

- 인터럽트
    - `입출력장치`에 의해 발생함
    - 인터럽트를 발생시키는 특정 명령어에 의해 발생하기도 함 → `소프트웨어 인터럽트`

> 💡 시스템 호출 작동 순서
>
> - 시스템 호출 발생
> - (커널 모드 전환)
> - CPU는 지금까지의 작업 백업 후, 커널 영역 내에 시스템 호출을 수행하는 코드 실행
> - (사용자 모드 복귀)
> - 다시 기존에 실행하던 응용 프로그램으로 복귀하여 실행을 계속해 나감
>
> ![image.png](https://github.com/user-attachments/assets/b0466c11-0af9-4710-bb63-ea55b364fe55)

### 운영체제의 핵심 서비스

---

- **프로세스 관리**
    - `프로세스` : 실행 중인 프로그램
    - 컴퓨터를 사용하는 동안 메모리 안에서는 새로운 프로세스들이 마구 생성되고, 사용되지 않는 프로세스는 메모리에서 삭제됨
    - 일반적으로 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있기에 CPU는 이 프로세스들을 조금씩 번갈아 가며 실행함
        - 다시 말해 CPU 는 한 프로세스를 실행하다가 다른 프로세스로 실행을 전환하고, 그 프로세스를 실행하다가 또 다른 프로세스로 실행을 전환하는 것을 반복함
        
        ![image.png](https://github.com/user-attachments/assets/36fb40d1-b35d-4600-9a4a-30f1ea566e57)
        

> 💡 여러 프로세스가 동시에 실행되는 환경에서는 `프로세스 동기화`가 필수적이고, `교착 상태`를 해결해야 한다.

- **지원 접근 및 할당**
    - 모든 프로세스는 실행을 위해 자원을 필요로 함
    - 운영체제는 프로세스들이 사용할 자원에 접근하고 조작함으로써 프로세스에 필요한 자원을 할당해 줌
    - `CPU`
        - 한 번에 하나의 프로세스만 실행할 수 있음
        - 프로세스들에 공정하게 CPU 를 할당하기 위해 `어떤` 프로세스부터 CPU 를 이용하게 할 것인지, `얼마나 오래` CPU 를 이용하게 할지를 결정할 수 있어야 함 →  `CPU 스케줄링`
    - `메모리 (, 보조기억장치)`
        - 메모리에 적재된 프로세스들은 크기도, 적재되는 주소도 가지각색임
        - 같은 프로세스라 할지라도 실행할 때마다 적재되는 주소가 달라질 수 있음
        - 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지를 결정해야
        - 때로는 메모리가 이미 꽉 차 있어 꼭 실행해야 할 프로세스를 적재할 공간이 없는 경우도 있고 , 메모리에 공간이 남았는 데도 불구하고 프로세스를 적재하지 못하는 상황도 발생함
    - `입출력장치`
        - 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 있음
        - 입출력장치가 CPU 에 하드웨어 인터럽트 요청 신호를 보내면 CPU 는 하던 일을 잠시 백업한 뒤 커널 영역에 있는 `인터럽트 서비스 루틴`을 실행함
        - 운영체제는 인터럽트를 처리하는 프로그램, 즉 인터럽트 서비스 루틴을 제공함으로써 입출력 작업을 수행함
- **파일 시스템 관리**
    - 파일 시스템도 운영체제가 지원하는 핵심 서비스임
    - 운영체제가 보조기억장치 속 데이터를 파일과 디렉터리로 관리함

### 가상 머신과 이중 모드의 발전

---

이중 모드는 커널 모드와 사용자 모드, 두 가지 모드를 지원하는 실행 모드이지만, 가상 머신을 통한 가상화를 지원하는 현대 CPU 는 두 가지 모드 이상을 지원한다.

- 가상 머신
    - 이름 그대로 소프트웨어적으로 만들어낸 가상 컴퓨터
    - 가상 머신을 설치하면 새로운 운영체제와 응용 프로그램을 설치하고 실행할 수 있음

> 💡 이때 컴퓨터에 설치된 운영체제에서 가상 머신을 설치 및 실행한다면, 그 가상 머신 또한 `응용 프로그램`이다. 마찬가지로 가상 머신상에 설치된 `운영체제` 또한 `사용자 모드`로 작동된다.

가상 머신에 설치된 응용 프로그램 ( 아래 예시 그림에서는 웹 브라우저 ) 이 운영체제 서비스를 제공받기 위해서는 커널 모드로 전환되어야 하는데, 가상 머신에 설치된 운영체제도 사용자 모드로 작동하면 운영체제 서비스를 제공받기 어렵다.

![image.png](https://github.com/user-attachments/assets/f85d1a8a-2a91-4b0c-91f6-787f2f5e910d)

그래서 가상화를 지원하는 CPU 는 커널 모드와 사용자 모드 이외에 가상 머신을 위한 모드인 `하이퍼바이저 모드`를 따로 둔다. 이로써 가상 머신 상에서 작동하는 응용 프로그램들은 하이퍼바이저 모드로써 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받을 수 있다.

### 시스템 호출의 종류

---

`시스템 호출`은 `운영체제 서비스를 제공받기 위한 방법`이므로 시스템 호출 종류만 잘 파악해도 해당 운영체제를 깊이 이해할 수 있다.

![image.png](https://github.com/user-attachments/assets/f4b0305a-b263-4a72-a512-cea0393ec121)